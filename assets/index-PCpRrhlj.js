function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/read-contract-cuBghJfu.js","assets/index-DdggzL-P.js","assets/index-DiwrgTda.css","assets/hashMessage-Ce-vC1Yy.js","assets/checkContractWalletSignature-DvvALFtd.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{m as te,B as ne,o as N,p as ae,q as re,r as G,A as se,v as U,x as j,y as ie,z as oe,C as ce,D as ue,E as W,F as k,G as z,H as de,P as pe,I as P,J as fe,K as le,L as J,n as me,c as ye,M as he,N as ge,O as q,Q as g,s as K,R as _,S as Y,T as ve,U as Ae,V as C,W as we,X as w,Y as I,_ as v,Z as M}from"./index-DdggzL-P.js";import{readContract as be}from"./read-contract-cuBghJfu.js";const S=new WeakSet;async function Q(t){if(S.has(t))return!0;const n=await te(t)!=="0x";return n&&S.add(t),n}const xe=Object.freeze(Object.defineProperty({__proto__:null,isContractDeployed:Q},Symbol.toStringTag,{value:"Module"}));class Oe extends ne{constructor(e){super(`Filter type "${e}" is not supported.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"FilterTypeNotSupportedError"})}}const T=N;function Ge(t){const{abi:e,args:n=[],name:r}=t,a=ae(r,{strict:!1}),i=e.filter(u=>a?u.type==="function"?re(u)===r:u.type==="event"?T(u)===r:!1:"name"in u&&u.name===r);if(i.length===0)return;if(i.length===1)return i[0];let s;for(const u of i){if(!("inputs"in u))continue;if(!n||n.length===0){if(!u.inputs||u.inputs.length===0)return u;continue}if(!u.inputs||u.inputs.length===0||u.inputs.length!==n.length)continue;if(n.every((o,f)=>{const l="inputs"in u&&u.inputs[f];return l?E(o,l):!1})){if(s&&"inputs"in s&&s.inputs){const o=X(u.inputs,s.inputs,n);if(o)throw new se({abiItem:u,type:o[0]},{abiItem:s,type:o[1]})}s=u}}return s||i[0]}function E(t,e){const n=typeof t,r=e.type;switch(r){case"address":return G(t,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return r==="tuple"&&"components"in e?Object.values(e.components).every((a,i)=>E(Object.values(t)[i],a)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(r)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(r)?n==="string"||t instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(r)?Array.isArray(t)&&t.every(a=>E(a,{...e,type:r.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function X(t,e,n){for(const r in t){const a=t[r],i=e[r];if(a.type==="tuple"&&i.type==="tuple"&&"components"in a&&"components"in i)return X(a.components,i.components,n[r]);const s=[a.type,i.type];if(s.includes("address")&&s.includes("bytes20")?!0:s.includes("address")&&s.includes("string")?G(n[r],{strict:!1}):s.includes("address")&&s.includes("bytes")?G(n[r],{strict:!1}):!1)return s}}const R="/docs/contract/encodeEventTopics";function Pe(t){var d;const{abi:e,eventName:n,args:r}=t;let a=e[0];if(n){const o=Ge({abi:e,name:n});if(!o)throw new U(n,{docsPath:R});a=o}if(a.type!=="event")throw new U(void 0,{docsPath:R});const i=j(a),s=T(i);let u=[];if(r&&"inputs"in a){const o=(d=a.inputs)==null?void 0:d.filter(l=>"indexed"in l&&l.indexed),f=Array.isArray(r)?r:Object.values(r).length>0?(o==null?void 0:o.map(l=>r[l.name]))??[]:[];f.length>0&&(u=(o==null?void 0:o.map((l,p)=>Array.isArray(f[p])?f[p].map((h,y)=>B({param:l,value:f[p][y]})):f[p]?B({param:l,value:f[p]}):null))??[])}return[s,...u]}function B({param:t,value:e}){if(t.type==="string"||t.type==="bytes")return ie(oe(e));if(t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/))throw new Oe(t.type);return ce([t],[e])}const F="/docs/contract/decodeEventLog";function Ee(t){const{abi:e,data:n,strict:r,topics:a}=t,i=r??!0,[s,...u]=a;if(!s)throw new ue({docsPath:F});const d=e.find(c=>c.type==="event"&&s===T(j(c)));if(!(d&&"name"in d)||d.type!=="event")throw new W(s,{docsPath:F});const{name:o,inputs:f}=d,l=f==null?void 0:f.some(c=>!("name"in c&&c.name));let p=l?[]:{};const h=f.filter(c=>"indexed"in c&&c.indexed);for(let c=0;c<h.length;c++){const m=h[c],A=u[c];if(!A)throw new k({abiItem:d,param:m});p[m.name||c]=De({param:m,value:A})}const y=f.filter(c=>!("indexed"in c&&c.indexed));if(y.length>0){if(n&&n!=="0x")try{const c=z(y,n);if(c)if(l)p=[...p,...c];else for(let m=0;m<y.length;m++)p[y[m].name]=c[m]}catch(c){if(i)throw c instanceof de||c instanceof pe?new P({abiItem:d,data:n,params:y,size:fe(n)}):c}else if(i)throw new P({abiItem:d,data:"0x",params:y,size:0})}return{eventName:o,args:Object.values(p).length>0?p:void 0}}function De({param:t,value:e}){return t.type==="string"||t.type==="bytes"||t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/)?e:(z([t],e)||[])[0]}function _e({abi:t,eventName:e,logs:n,strict:r=!0}){return n.map(a=>{var i;try{const s=Ee({...a,abi:t,strict:r});return e&&!e.includes(s.eventName)?null:{...s,...a}}catch(s){let u,d;if(s instanceof W)return null;if(s instanceof P||s instanceof k){if(r)return null;u=s.abiItem.name,d=(i=s.abiItem.inputs)==null?void 0:i.some(o=>!("name"in o&&o.name))}return{...a,args:d?[]:{},eventName:u}}}).filter(Boolean)}function Te(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="event")}function Le(t){const{signature:e}=t;let n;return Te(e)?n=e:n=le(e),{abiEvent:n,hash:N(n),topics:Pe({abi:[n],args:t.filters})}}function Ue(t){const{logs:e,events:n,strict:r}=t;return _e({logs:e,abi:n.map(a=>a.abiEvent),strict:r})}function Ce(t={}){return Le({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:t})}const Ie="0xfffffffffffffffffffffffffffffff0000000000000000000000000000000007aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa1c",b="0x5FF137D4b0FDCD49DcA30c7CF57E578a026d2789",Me=50000n,Z=t=>`https://${t.id}.bundler.thirdweb.com/`,Se=t=>`https://${t.id}.bundler.thirdweb.com/`,Re=()=>{const t=BigInt(Math.floor(Math.random()*4294967296)),e=BigInt(Math.floor(Math.random()*4294967296)),n=BigInt(Math.floor(Math.random()*4294967296)),r=BigInt(Math.floor(Math.random()*4294967296)),a=BigInt(Math.floor(Math.random()*4294967296)),i=BigInt(Math.floor(Math.random()*4294967296));return t<<BigInt(160)|e<<BigInt(128)|n<<BigInt(96)|r<<BigInt(64)|a<<BigInt(32)|i},Be=()=>BigInt(J([me(Re()),"0x0000000000000000"]));function L(t){return Object.fromEntries(Object.entries(t).map(([e,n])=>[e,ye(n)?n:he(n)]))}async function Fe(t){var e;return x({...t,operation:"eth_sendUserOperation",params:[L(t.userOp),((e=t.options.overrides)==null?void 0:e.entrypointAddress)??b]})}async function $(t){var n;const e=await x({...t,operation:"eth_estimateUserOperationGas",params:[L(t.userOp),((n=t.options.overrides)==null?void 0:n.entrypointAddress)??b]});return{preVerificationGas:g(e.preVerificationGas),verificationGas:g(e.verificationGas),verificationGasLimit:g(e.verificationGasLimit),callGasLimit:g(e.callGasLimit)+Me}}async function $e(t){const e=await x({...t,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:g(e.maxPriorityFeePerGas),maxFeePerGas:g(e.maxFeePerGas)}}async function He(t){var n,r;const e=await x({...t,operation:"eth_getUserOperationReceipt",params:[t.userOpHash]});if(e){if(e.success===!1){const i=(r=(n=Ue({events:[Ce()],logs:e.logs})[0])==null?void 0:n.args)==null?void 0:r.revertReason;if(!i)throw new Error(`UserOp failed at txHash: ${e.transactionHash}`);const s=ge({data:i});throw new Error(`UserOp failed with reason: '${s.args.join(",")}' at txHash: ${e.transactionHash}`)}return e.receipt}}async function x(t){var d;const{options:e,operation:n,params:r}=t,a=((d=e.overrides)==null?void 0:d.bundlerUrl)??Z(e.chain),s=await q(e.client)(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:n,params:r})}),u=await s.json();if(!s.ok||u.error){let o=u.error||s.statusText;typeof o=="object"&&(o=JSON.stringify(o));const f=u.code||"UNKNOWN";throw new Error(`${n} error: ${o}
Status: ${s.status}
Code: ${f}`)}return u.result}async function Ve(t,e){var a,i,s;if((a=e.overrides)!=null&&a.predictAddress)return e.overrides.predictAddress(t);const n=((i=e.overrides)==null?void 0:i.accountAddress)||e.personalAccountAddress;if(!n)throw new Error("Account address is required to predict the smart wallet address.");const r=K(((s=e.overrides)==null?void 0:s.accountSalt)??"");return be({contract:t,method:"function getAddress(address, bytes) returns (address)",params:[n,r]})}function Ne(t){var r,a,i;const{factoryContract:e,options:n}=t;return(r=n.overrides)!=null&&r.createAccount?n.overrides.createAccount(e):_({contract:e,method:"function createAccount(address, bytes) returns (address)",params:[((a=n.overrides)==null?void 0:a.accountAddress)||n.personalAccount.address,K(((i=n.overrides)==null?void 0:i.accountSalt)??"")]})}function je(t){var a;const{accountContract:e,options:n,transaction:r}=t;return(a=n.overrides)!=null&&a.execute?n.overrides.execute(e,r):_({contract:e,method:"function execute(address, uint256, bytes)",params:[r.to||"",r.value||0n,r.data||"0x"]})}function We(t){var a;const{accountContract:e,options:n,transactions:r}=t;return(a=n.overrides)!=null&&a.executeBatch?n.overrides.executeBatch(e,r):_({contract:e,method:"function executeBatch(address[], uint256[], bytes[])",params:[r.map(i=>i.to||""),r.map(i=>i.value||0n),r.map(i=>i.data||"0x")]})}async function H(t){var l,p,h,y;const{userOp:e,options:n}=t;if((l=n.overrides)!=null&&l.paymaster)return(p=n.overrides)==null?void 0:p.paymaster(e);const r={"Content-Type":"application/json"},a=n.client,i=Se(n.chain),s=((h=n.overrides)==null?void 0:h.entrypointAddress)??b,d=await q(a)(i,{method:"POST",headers:r,body:JSON.stringify({jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[L(e),s]})}),o=await d.json();if(!d.ok){const c=o.error||d.statusText,m=o.code||"UNKNOWN";throw new Error(`Paymaster error: ${c}
Status: ${d.status}
Code: ${m}`)}if(o.result)return typeof o.result=="string"?{paymasterAndData:o.result}:{paymasterAndData:o.result.paymasterAndData,verificationGasLimit:o.result.verificationGasLimit?g(o.result.verificationGasLimit):void 0,preVerificationGas:o.result.preVerificationGas?g(o.result.preVerificationGas):void 0,callGasLimit:o.result.callGasLimit?g(o.result.callGasLimit):void 0};const f=((y=o.error)==null?void 0:y.message)||o.error||d.statusText||"unknown error";throw new Error(`Paymaster error from ${i}: ${f}`)}async function ke(t){var y;const{factoryContract:e,accountContract:n,executeTx:r,options:a}=t,s=await Q(n)?"0x":await Je({factoryContract:e,options:a}),u=await Y(r);let{maxFeePerGas:d,maxPriorityFeePerGas:o}=r;const f=((y=a.overrides)==null?void 0:y.bundlerUrl)??Z(a.chain);if(ve(f)){const c=await $e({options:a});d=c.maxFeePerGas,o=c.maxPriorityFeePerGas}else if(!d||!o){const c=await Ae(e.client,e.chain);o||(o=c.maxPriorityFeePerGas??void 0),d||(d=c.maxFeePerGas??void 0)}const l=Be(),p={sender:n.address,nonce:l,initCode:s,callData:u,maxFeePerGas:await C(d)??0n,maxPriorityFeePerGas:await C(o)??0n,callGasLimit:0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:Ie};if(a.gasless){const c=await H({userOp:p,options:a}),m=c.paymasterAndData;if(m&&m!=="0x"&&(p.paymasterAndData=m),c.callGasLimit&&c.verificationGasLimit&&c.preVerificationGas)p.callGasLimit=c.callGasLimit,p.verificationGasLimit=c.verificationGasLimit,p.preVerificationGas=c.preVerificationGas;else{const A=await $({userOp:p,options:a});if(p.callGasLimit=A.callGasLimit,p.verificationGasLimit=A.verificationGasLimit,p.preVerificationGas=A.preVerificationGas,m&&m!=="0x"){const O=await H({userOp:p,options:a});O.paymasterAndData&&O.paymasterAndData!=="0x"&&(p.paymasterAndData=O.paymasterAndData)}}}else{const c=await $({userOp:p,options:a});p.callGasLimit=c.callGasLimit,p.verificationGasLimit=c.verificationGasLimit,p.preVerificationGas=c.preVerificationGas}return{...p,signature:"0x"}}async function ze(t){var a;const{userOp:e,options:n}=t,r=qe({userOp:e,entryPoint:((a=n.overrides)==null?void 0:a.entrypointAddress)||b,chainId:n.chain.id});if(n.personalAccount.signMessage){const i=await n.personalAccount.signMessage({message:{raw:we(r)}});return{...e,signature:i}}throw new Error("signMessage not implemented in signingAccount")}async function Je(t){const{factoryContract:e,options:n}=t,r=Ne({factoryContract:e,options:n});return J([e.address,await Y(r)])}function qe(t){const{userOp:e,entryPoint:n,chainId:r}=t,a=w(e.initCode),i=w(e.callData),s=w(e.paymasterAndData),u=I([{type:"address"},{type:"uint256"},{type:"bytes32"},{type:"bytes32"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"bytes32"}],[e.sender,e.nonce,a,i,e.callGasLimit,e.verificationGasLimit,e.preVerificationGas,e.maxFeePerGas,e.maxPriorityFeePerGas,s]),d=I([{type:"bytes32"},{type:"address"},{type:"uint256"}],[w(u),n,BigInt(r)]);return w(d)}const ee=new WeakMap,D=new WeakMap;async function et(t,e,n){const{personalAccount:r,client:a,chain:i}=e;if(!r)throw new Error("Personal wallet does not have an account");const s=n,u=i??s.chain,d=s.factoryAddress,o=M({client:a,address:d,chain:u}),f=await Ve(o,{personalAccountAddress:r.address,...s}),l=M({client:a,address:f,chain:u}),p=await Ke({...s,personalAccount:r,accountContract:l,factoryContract:o,client:a});return ee.set(r,t),D.set(t,r),[p,u]}async function tt(t){const e=D.get(t);e&&(ee.delete(e),D.delete(t))}async function Ke(t){const{accountContract:e,factoryContract:n}=t,r={address:e.address,async sendTransaction(a){const i=je({accountContract:e,options:t,transaction:a});return V({factoryContract:n,accountContract:e,executeTx:i,options:t})},async sendBatchTransaction(a){const i=We({accountContract:e,options:t,transactions:a});return V({factoryContract:n,accountContract:e,executeTx:i,options:t})},async signMessage({message:a}){const[{isContractDeployed:i},{readContract:s},{encodeAbiParameters:u},{hashMessage:d},{checkContractWalletSignature:o}]=await Promise.all([v(()=>Promise.resolve().then(()=>xe),void 0),v(()=>import("./read-contract-cuBghJfu.js"),__vite__mapDeps([0,1,2])),v(()=>import("./index-DdggzL-P.js").then(c=>c.ag),__vite__mapDeps([1,2])),v(()=>import("./hashMessage-Ce-vC1Yy.js"),__vite__mapDeps([3,1,2])),v(()=>import("./checkContractWalletSignature-DvvALFtd.js"),__vite__mapDeps([4,0,1,2]))]);await i(e)||(console.log("Account contract not deployed yet. Deploying account before signing message"),await Ye({options:t,account:r,accountContract:e}));const l=d(a);let p=!1;try{await s({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[l]}),p=!0}catch{}let h;if(p){const c=u([{type:"bytes32"}],[l]);h=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:c}})}else h=await t.personalAccount.signMessage({message:a});if(await o({contract:e,message:a,signature:h}))return h;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async signTypedData(a){return t.personalAccount.signTypedData(a)},async estimateGas(a){return 0n}};return r}async function Ye(t){const{options:e,account:n,accountContract:r}=t,[{sendTransaction:a},{prepareTransaction:i}]=await Promise.all([v(()=>import("./index-DdggzL-P.js").then(d=>d.ai),__vite__mapDeps([1,2])),v(()=>import("./index-DdggzL-P.js").then(d=>d.ah),__vite__mapDeps([1,2]))]),s=i({client:e.client,chain:e.chain,to:r.address,value:0n});return await a({transaction:s,account:n})}async function V(t){const{factoryContract:e,accountContract:n,executeTx:r,options:a}=t,i=await ke({factoryContract:e,accountContract:n,executeTx:r,options:a}),s=await ze({options:a,userOp:i}),u=await Fe({options:a,userOp:s}),d=await Qe({options:a,userOpHash:u});return{client:a.client,chain:a.chain,transactionHash:d.transactionHash}}async function Qe(t){const{options:e,userOpHash:n}=t,r=3e4,a=1e3,i=Date.now()+r;for(;Date.now()<i;){const s=await He({options:e,userOpHash:n});if(s)return s;await new Promise(u=>setTimeout(u,a))}throw new Error("Timeout waiting for userOp to be mined")}export{et as connectSmartWallet,tt as disconnectSmartWallet,ee as personalAccountToSmartAccountMap};
