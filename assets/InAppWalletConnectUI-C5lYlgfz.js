import{aH as M,aI as P,ah as c,an as e,ao as s,az as F,as as U,aB as I,aJ as O,at as _,aK as H,ai as b,ag as z,aL as N,ap as R,aq as m,ay as w,au as T,aM as W,aN as q,aO as V,aF as $}from"./index-BzfMB0jv.js";import{o as K,u as Q,a as Y}from"./useInAppWalletLocale-kGjMTQL0.js";const D=M({animation:`${P} 0.15s ease-in`});function G(n){const l=n.value.split(""),a=y=>{n.setValue(y.join(""))},d=l.length,u=c.useRef([]);return c.useEffect(()=>{u.current[d]&&requestAnimationFrame(()=>{var y;(y=u.current[d])==null||y.focus()})},[d]),e.jsx(s,{center:"x",gap:"sm",flex:"row",children:new Array(n.digits).fill(null).map((y,i)=>e.jsx(J,{"data-error":n.isInvalid,ref:t=>{u.current[i]=t},value:l[i]??"",type:"text",pattern:"[a-zA-Z0-9]*",variant:"outline",inputMode:"text",onPaste:t=>{const x=t.clipboardData.getData("text/plain").slice(0,n.digits).split("");a(x),t.preventDefault()},onKeyDown:t=>{var r,x;if(t.key==="Enter"&&n.onEnter){n.onEnter();return}if(t.key==="ArrowLeft"){if(i===0)return;(r=u.current[i-1])==null||r.focus();return}if(t.key==="ArrowRight"){if(i===n.digits-1)return;(x=u.current[i+1])==null||x.focus();return}if(t.key==="e"||t.key==="."){t.preventDefault();return}if(t.key==="Backspace"){if(i===0)return;const o=l.slice(0,-1);a(o)}},onChange:t=>{let r=t.target.value;if(r.length>1){const S=r[r.length-1];S&&(r=S)}if(!/\d/.test(r)&&r!==""){t.preventDefault();return}const x=[...l],o=i>d-1?d:i;x[o]=r,a(x)}},i))})}const J=F(U)(()=>{const n=I();return{appearance:"none",WebkitAppearance:"none",width:"40px",height:"40px",textAlign:"center",fontSize:O.md,padding:_.xs,[H.mobile]:{width:"35px",height:"35px"},"&[data-verify-status='invalid']":{color:n.colors.danger,borderColor:n.colors.danger}}});function Z(n){const{wallet:l,done:a,goBack:d}=n,u=n.email,{modalSize:y}=c.useContext(b),i=y==="wide",t=n.locale,[r,x]=c.useState(""),{client:o,chain:S}=z(),[v,j]=c.useState("idle"),[f,E]=c.useState("sending"),[k]=c.useState("base"),A=c.useCallback(async()=>{x(""),j("idle"),E("sending");try{const g=await N({email:u,strategy:"email",client:o});E(g)}catch(g){console.error(g),j("idle"),E("error")}},[o,u]),h=async g=>{var B;if(!(typeof f!="object"||g.length!==6)&&(j("idle"),typeof f=="object"&&l))try{if(j("verifying"),f.recoveryShareManagement==="USER_MANAGED"&&(f.isNewUser||f.isNewDevice))if(f.isNewUser)try{await l.connect({chain:S,strategy:"email",email:u,verificationCode:g,client:o})}catch(p){if(!(p instanceof Error&&p.message.includes("encryption key")))throw p}else try{await l.connect({chain:S,strategy:"email",email:u,verificationCode:g,client:o})}catch(p){if(!(p instanceof Error&&p.message.includes("encryption key")))throw p}else{if(!await l.connect({chain:S,strategy:"email",email:u,verificationCode:g,client:o}))throw new Error("Failed to verify OTP");a()}j("valid")}catch(C){C instanceof Error&&((B=C==null?void 0:C.message)!=null&&B.includes("PAYMENT_METHOD_REQUIRED"))?j("payment_required"):j("invalid"),console.error("Authentication Error",C)}},L=c.useRef(!1);return c.useEffect(()=>{L.current||(L.current=!0,A())},[A]),k==="base"?e.jsxs(s,{fullHeight:!0,flex:"column",animate:"fadein",children:[e.jsx(s,{p:"lg",children:e.jsx(R,{title:t.signIn,onBack:d})}),e.jsx(s,{expand:!0,flex:"column",center:"y",children:e.jsxs("form",{onSubmit:g=>{g.preventDefault()},children:[e.jsxs(s,{flex:"column",center:"x",px:"lg",children:[!i&&e.jsx(m,{y:"xl"}),e.jsx(w,{children:t.emailLoginScreen.enterCodeSendTo}),e.jsx(m,{y:"sm"}),e.jsx(w,{color:"primaryText",children:u}),e.jsx(m,{y:"xl"})]}),e.jsx(G,{isInvalid:v==="invalid",digits:6,value:r,setValue:g=>{x(g),j("idle"),h(g)},onEnter:()=>{h(r)}}),v==="invalid"&&e.jsxs(D,{children:[e.jsx(m,{y:"md"}),e.jsx(w,{size:"sm",color:"danger",center:!0,children:t.emailLoginScreen.invalidCode})]}),v==="payment_required"&&e.jsxs(D,{children:[e.jsx(m,{y:"md"}),e.jsx(w,{size:"sm",color:"danger",center:!0,children:t.maxAccountsExceeded})]}),e.jsx(m,{y:"xl"}),e.jsx(s,{px:i?"xxl":"lg",children:v==="verifying"?e.jsx(e.Fragment,{children:e.jsx(s,{flex:"row",center:"x",animate:"fadein",children:e.jsx(T,{size:"lg",color:"accentText"})})}):e.jsx(s,{animate:"fadein",children:e.jsx(W,{onClick:()=>h(r),variant:"accent",type:"submit",style:{width:"100%"},children:t.emailLoginScreen.verify})},"btn-container")}),e.jsx(m,{y:"xl"}),!i&&e.jsx(q,{}),e.jsxs(s,{p:i?void 0:"lg",children:[f==="error"&&e.jsx(e.Fragment,{children:e.jsx(w,{size:"sm",center:!0,color:"danger",children:t.emailLoginScreen.failedToSendCode})}),f==="sending"&&e.jsxs(s,{flex:"row",center:"both",gap:"xs",style:{textAlign:"center"},children:[e.jsx(w,{size:"sm",children:t.emailLoginScreen.sendingCode}),e.jsx(T,{size:"xs",color:"secondaryText"})]}),typeof f=="object"&&e.jsx(X,{onClick:A,type:"button",children:t.emailLoginScreen.resendCode})]})]})})]}):null}const X=V(()=>{const n=I();return{all:"unset",color:n.colors.accentText,fontSize:O.sm,cursor:"pointer",textAlign:"center",fontWeight:500,width:"100%","&:hover":{color:n.colors.primaryText}}});function ee(n){var k;const l=n.locale,a=l.socialLoginScreen,d=I(),{modalSize:u}=c.useContext(b),[y,i]=c.useState(void 0),{done:t,wallet:r}=n,[x,o]=c.useState("connecting"),{client:S,chain:v}=z(),j=async()=>{var A;try{const h=K(n.socialAuth,d);if(!h)throw new Error(`Failed to open ${n.socialAuth} login window`);o("connecting"),await r.connect({chain:v,strategy:n.socialAuth,openedWindow:h,closeOpenedWindow:L=>{L.close()},client:S}),o("connected"),t()}catch(h){o("error"),h instanceof Error&&((A=h==null?void 0:h.message)!=null&&A.includes("PAYMENT_METHOD_REQUIRED"))&&i(l.maxAccountsExceeded),console.error(`Error sign in with ${n.socialAuth}`,h)}},f=(k=n.state)==null?void 0:k.socialLogin,E=c.useRef(!1);return c.useEffect(()=>{E.current||f&&(E.current=!0,o("connecting"),f.connectionPromise.then(()=>{t(),o("connected")}).catch(()=>{o("error")}))},[t,f]),e.jsx(s,{animate:"fadein",flex:"column",fullHeight:!0,children:e.jsxs(s,{flex:"column",expand:!0,p:"lg",style:{paddingBottom:0},children:[e.jsx(R,{title:a.title,onBack:n.goBack}),u==="compact"?e.jsx(m,{y:"xl"}):null,e.jsxs(s,{flex:"column",center:"both",expand:!0,style:{textAlign:"center",minHeight:"250px"},children:[x!=="error"&&e.jsxs(s,{animate:"fadein",children:[e.jsx(w,{color:"primaryText",center:!0,multiline:!0,style:{maxWidth:"250px"},children:a.instruction}),e.jsx(m,{y:"xl"}),e.jsx(s,{center:"x",flex:"row",children:e.jsx(T,{size:"lg",color:"accentText"})}),e.jsx(m,{y:"xxl"})]}),x==="error"&&e.jsxs(s,{animate:"fadein",children:[e.jsx(w,{color:"danger",children:a.failed}),y&&e.jsx(w,{color:"danger",children:y}),e.jsx(m,{y:"lg"}),e.jsx(W,{variant:"primary",onClick:j,children:a.retry}),e.jsx(m,{y:"xxl"})]})]})]})})}function ae(n){const{data:l}=c.useContext(b),a=l,d=Q();return d?a!=null&&a.emailLogin?e.jsx(Z,{email:a.emailLogin,locale:d,done:n.done,goBack:n.goBack,wallet:n.wallet}):a!=null&&a.socialLogin?e.jsx(ee,{socialAuth:a.socialLogin.type,locale:d,done:n.done,goBack:n.goBack,wallet:n.wallet,state:a}):e.jsx(Y,{select:()=>{},locale:d,done:n.done,goBack:n.goBack,wallet:n.wallet}):e.jsx($,{})}export{ae as default};
